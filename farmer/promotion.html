<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å“æ¨å¹¿ - è´­ä¹°ç§¯åˆ† - æ™ºè€˜äº‘é“¾</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Inter", "Microsoft YaHei", sans-serif;
        }
        body {
            background: linear-gradient(135deg, #e8f4f8 0%, #f0f8fb 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .header {
            max-width: 800px;
            margin: 0 auto 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        .brand {
            font-size: 24px;
            color: #1e40af;
            font-weight: 700;
        }
        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s;
            display: inline-block;
        }
        .back-manage {
            color: #3b82f6;
            border: 1px solid #3b82f6;
        }
        .back-manage:hover {
            background: #3b82f6;
            color: white;
        }
        /* æ¨å¹¿è¡¨å•å®¹å™¨ */
        .promotion-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(149, 157, 165, 0.15);
            padding: 40px;
        }
        /* å•†å“ä¿¡æ¯æ  */
        .product-info-card {
            background: #f0f9ff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid #bae6fd;
        }
        .product-info-title {
            font-size: 18px;
            color: #1e40af;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .product-info-desc {
            color: #64748b;
            font-size: 14px;
            line-height: 1.6;
        }
        /* ç§¯åˆ†è§„åˆ™æç¤º */
        .rule-tip {
            background: #fef3c7;
            border-radius: 8px;
            padding: 10px 16px;
            margin-bottom: 25px;
            font-size: 14px;
            color: #92400e;
            border-left: 4px solid #f59e0b;
        }
        /* è¡¨å•é¡¹ */
        .form-item {
            margin-bottom: 25px;
        }
        .form-item label {
            display: block;
            margin-bottom: 8px;
            color: #475569;
            font-weight: 500;
            font-size: 14px;
        }
        .form-item input, .form-item select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background-color: #f8fafc;
        }
        .form-item input:focus, .form-item select:focus {
            outline: none;
            border-color: #3b82f6;
            background-color: white;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }
        /* é‡‘é¢è®¡ç®—æ  */
        .price-card {
            background: #f0fdf4;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0 30px;
            border: 1px solid #bbf7d0;
        }
        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .price-label {
            color: #065f46;
        }
        .price-value {
            color: #059669;
            font-weight: 600;
        }
        .total-price {
            font-size: 18px;
            padding-top: 10px;
            border-top: 1px dashed #bbf7d0;
            margin-top: 10px;
        }
        /* æäº¤æŒ‰é’® */
        .submit-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        .submit-btn:hover {
            background: linear-gradient(90deg, #059669 0%, #047857 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }
        .submit-btn:active {
            transform: translateY(0);
        }
        /* æç¤ºä¿¡æ¯ */
        .tip {
            text-align: center;
            margin-top: 15px;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px;
            display: none;
            line-height: 1.6;
        }
        .tip.error {
            color: #ef4444;
            background-color: #fef2f2;
            display: block;
        }
        .tip.success {
            color: #22c55e;
            background-color: #f0fdf4;
            display: block;
        }
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            .promotion-container {
                padding: 20px;
            }
            .price-row {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="brand">æ™ºè€˜äº‘é“¾ - å•†å“æ¨å¹¿</div>
        <a href="manage.html" class="btn back-manage">è¿”å›å•†å“ç®¡ç†</a>
    </div>

    <div class="promotion-container">
        <!-- å•†å“ä¿¡æ¯å±•ç¤º -->
        <div class="product-info-card">
            <div class="product-info-title" id="productName">å•†å“åç§°</div>
            <div class="product-info-desc" id="productDesc">å•†å“IDï¼š-- | å½“å‰ç§¯åˆ†ï¼š--</div>
        </div>

        <!-- ç§¯åˆ†è§„åˆ™æç¤º -->
        <div class="rule-tip">
            ğŸ“Œ æ¨å¹¿è§„åˆ™ï¼šæ¯æ”¯ä»˜1å…ƒå¯è´­ä¹°5ä¸ªå•†å“ç§¯åˆ†ï¼Œç§¯åˆ†è¶Šé«˜å•†å“è¶Šå®¹æ˜“å‡ºç°åœ¨çƒ­é—¨æ¨èæ 
        </div>

        <!-- æ¨å¹¿è¡¨å• -->
        <form id="promotionForm">
            <!-- è´­ä¹°ç§¯åˆ†å€¼ -->
            <div class="form-item">
                <label for="buyPoints">è´­ä¹°ç§¯åˆ†å€¼ <span style="color:#ef4444;">*</span></label>
                <input type="number" id="buyPoints" placeholder="è¯·è¾“å…¥è¦è´­ä¹°çš„ç§¯åˆ†å€¼ï¼ˆæœ€å°‘5ç§¯åˆ†ï¼Œæ­¥é•¿5ï¼‰" min="5" step="5" oninput="calculateCost()">
            </div>

            <!-- æ”¯ä»˜æ–¹å¼ -->
            <div class="form-item">
                <label for="payMethod">æ”¯ä»˜æ–¹å¼ <span style="color:#ef4444;">*</span></label>
                <select id="payMethod">
                    <option value="">è¯·é€‰æ‹©æ”¯ä»˜æ–¹å¼</option>
                    <option value="alipay">æ”¯ä»˜å®</option>
                    <option value="wechat">å¾®ä¿¡æ”¯ä»˜</option>
                    <option value="bank">é“¶è¡Œå¡æ”¯ä»˜</option>
                </select>
            </div>

            <!-- é‡‘é¢è®¡ç®— -->
            <div class="price-card">
                <div class="price-row">
                    <span class="price-label">è´­ä¹°ç§¯åˆ†ï¼š</span>
                    <span class="price-value" id="pointsDisplay">0 ç§¯åˆ†</span>
                </div>
                <div class="price-row">
                    <span class="price-label">ç§¯åˆ†å•ä»·ï¼š</span>
                    <span class="price-value">5 ç§¯åˆ†/å…ƒ</span>
                </div>
                <div class="price-row total-price">
                    <span class="price-label">éœ€è¦æ”¯ä»˜ï¼š</span>
                    <span class="price-value" id="costDisplay">0.00 å…ƒ</span>
                </div>
            </div>

            <!-- æäº¤æŒ‰é’® -->
            <button type="button" class="submit-btn" onclick="submitPromotion()">ç¡®è®¤è´­ä¹°</button>
            <div class="tip" id="formTip"></div>
        </form>
    </div>

    <!-- å¼•å…¥ç§¯åˆ†å·¥å…·å‡½æ•° -->
    <script src="pointsUtils.js"></script>
    <script>
        // åˆå§‹åŒ–å•†å“ä¿¡æ¯
        let productId = '';
        let productName = '';
        let loginUsername = localStorage.getItem('loginUsername');

        // é¡µé¢åŠ è½½åˆå§‹åŒ–
        window.onload = function() {
            // éªŒè¯ç™»å½•çŠ¶æ€
            if (!loginUsername) {
                alert('è¯·å…ˆç™»å½•ï¼');
                window.location.href = 'index.html';
                return;
            }

            // è§£æURLå‚æ•°
            const params = new URLSearchParams(window.location.search);
            productId = params.get('productId') || '';
            productName = decodeURIComponent(params.get('productName') || 'æœªçŸ¥å•†å“');

            // éªŒè¯å•†å“ä¿¡æ¯
            if (!productId) {
                alert('å•†å“ä¿¡æ¯å¼‚å¸¸ï¼Œæ— æ³•æ¨å¹¿ï¼');
                window.location.href = 'manage.html';
                return;
            }

            // æ¸²æŸ“å•†å“ä¿¡æ¯ï¼ˆå«å½“å‰ç§¯åˆ†ï¼‰
            const currentPoints = getProductPoints(productId);
            document.getElementById('productName').textContent = productName;
            document.getElementById('productDesc').textContent = `å•†å“IDï¼š${productId} | å½“å‰ç§¯åˆ†ï¼š${currentPoints}`;
        }

        // è®¡ç®—èŠ±è´¹é‡‘é¢ï¼ˆ1å…ƒ=5ç§¯åˆ†ï¼‰
        function calculateCost() {
            const pointsInput = document.getElementById('buyPoints');
            const buyPoints = parseFloat(pointsInput.value) || 0;
            const pointsDisplay = document.getElementById('pointsDisplay');
            const costDisplay = document.getElementById('costDisplay');

            // æ›´æ–°ç§¯åˆ†æ˜¾ç¤º
            pointsDisplay.textContent = `${buyPoints} ç§¯åˆ†`;

            // è®¡ç®—èŠ±è´¹ï¼šç§¯åˆ† / 5ï¼ˆ1å…ƒ=5ç§¯åˆ†ï¼‰
            if (buyPoints >= 5 && buyPoints % 5 === 0) { // é™åˆ¶æ­¥é•¿5
                const cost = buyPoints / 5;
                costDisplay.textContent = `${cost.toFixed(2)} å…ƒ`;
            } else {
                costDisplay.textContent = '0.00 å…ƒ';
            }
        }

        // æäº¤æ¨å¹¿ï¼ˆè´­ä¹°ç§¯åˆ†ï¼‰
        function submitPromotion() {
            const tip = document.getElementById('formTip');
            tip.className = 'tip';
            tip.textContent = '';

            // è·å–è¡¨å•å€¼
            const buyPoints = parseFloat(document.getElementById('buyPoints').value) || 0;
            const payMethod = document.getElementById('payMethod').value;

            // è¡¨å•éªŒè¯
            if (buyPoints < 5) {
                tip.className = 'tip error';
                tip.textContent = 'è´­ä¹°ç§¯åˆ†ä¸èƒ½å°‘äº5ç§¯åˆ†ï¼';
                return;
            }
            if (buyPoints % 5 !== 0) {
                tip.className = 'tip error';
                tip.textContent = 'è´­ä¹°ç§¯åˆ†å¿…é¡»æ˜¯5çš„å€æ•°ï¼ˆ1å…ƒ=5ç§¯åˆ†ï¼‰ï¼';
                return;
            }
            if (!payMethod) {
                tip.className = 'tip error';
                tip.textContent = 'è¯·é€‰æ‹©æ”¯ä»˜æ–¹å¼ï¼';
                return;
            }

            // è®¡ç®—æ”¯ä»˜é‡‘é¢
            const cost = buyPoints / 5;

            // æ ¸å¿ƒï¼šç›´æ¥å¢åŠ å•†å“ç§¯åˆ†ï¼ˆè°ƒç”¨å·¥å…·å‡½æ•°ï¼‰
            const newProductPoints = addProductPointsDirect(productId, buyPoints);

            // è®°å½•æ¨å¹¿è®¢å•
            const promoteOrder = {
                orderId: 'PRO' + Date.now(),
                productId: productId,
                productName: productName,
                buyPoints: buyPoints,
                cost: cost.toFixed(2),
                payMethod: payMethod,
                sellerName: loginUsername,
                createTime: new Date().toLocaleString()
            };
            let promoteOrders = JSON.parse(localStorage.getItem('promoteOrders')) || [];
            promoteOrders.push(promoteOrder);
            localStorage.setItem('promoteOrders', JSON.stringify(promoteOrders));

            // æˆåŠŸæç¤º
            tip.className = 'tip success';
            tip.textContent = `æ¨å¹¿æˆåŠŸï¼
è®¢å•IDï¼š${promoteOrder.orderId}
è´­ä¹°ç§¯åˆ†ï¼š+${buyPoints}
æ”¯ä»˜é‡‘é¢ï¼š${cost.toFixed(2)} å…ƒ
å•†å“å½“å‰æ€»ç§¯åˆ†ï¼š${newProductPoints}`;

            // ç¦ç”¨æäº¤æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤æäº¤
            document.querySelector('.submit-btn').disabled = true;
            document.querySelector('.submit-btn').textContent = 'è´­ä¹°æˆåŠŸ';

            // 3ç§’åè¿”å›å•†å“ç®¡ç†é¡µé¢
            setTimeout(() => {
                window.location.href = 'manage.html';
            }, 3000);
        }
    </script>
</body>
</html>